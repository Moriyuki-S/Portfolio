---
import '../styles/global.css';
import { ClientRouter, fade } from 'astro:transitions';
import { FooterNav } from 'src/components/layout/footerNav';
import { Header } from 'src/components/layout/header';

const lang = Astro.locals.lang ?? 'ja';
---

<!doctype html>
<html lang={lang}>
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width" />
		<link rel="icon" type="image/jpeg" href="/favicon.jpg" />
		<meta name="generator" content={Astro.generator} />
		<title>Moriyuki Suzuki's Portfolio</title>
		<script is:inline>
			const themeMediaQuery =
				typeof window !== 'undefined' && window.matchMedia
					? window.matchMedia('(prefers-color-scheme: dark)')
					: null;

			const applyThemePreference = (targetDocument = document) => {
				const root = targetDocument?.documentElement;
				if (!root) return;

				let storedTheme = null;
				try {
					storedTheme = localStorage.getItem('theme');
				} catch (error) {
					storedTheme = null;
				}

				const prefersDark = themeMediaQuery ? themeMediaQuery.matches : false;
				const shouldUseDark =
					storedTheme === 'dark' ||
					(storedTheme !== 'theme-light' && prefersDark);
				root.classList[shouldUseDark ? 'add' : 'remove']('dark');
			};

			applyThemePreference();
			document.addEventListener('astro:before-swap', (event) => {
				const nextDocument = event?.newDocument ?? document;
				applyThemePreference(nextDocument);
			});
			document.addEventListener('astro:after-swap', () => {
				applyThemePreference();
			});
			if (themeMediaQuery) {
				const listener = () => applyThemePreference();
				if (typeof themeMediaQuery.addEventListener === 'function') {
					themeMediaQuery.addEventListener('change', listener);
				} else if ('onchange' in themeMediaQuery) {
					themeMediaQuery.onchange = listener;
				}
			}

			document.addEventListener('astro:before-preparation', (event) => {
				const beforeEvent = event;
				if (
					beforeEvent &&
					'info' in beforeEvent &&
					beforeEvent.info &&
					beforeEvent.info.direction === 'back'
				) {
					beforeEvent.direction = 'back';
				}
			});
		</script>
		<ClientRouter />
	</head>
	<body transition:animate={fade({ duration: '0.6s' })}  class="min-h-screen bg-white text-slate-900 antialiased text-slate-600 dark:text-slate-300 dark:bg-slate-950">
		<Header transition:persist client:load />
		<slot />
		<FooterNav transition:persist client:idle />
	</body>
</html>

<style>
	html,
	body {
		margin: 0;
		width: 100%;
		min-height: 100vh;
		min-height: 100dvh;
	}
</style>
